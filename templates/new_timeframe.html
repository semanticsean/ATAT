<!--templates/new_timeframe.html-->
<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Create New Meeting</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.4/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }

      #content {
        min-height: 100%;
        margin-bottom: -4rem;
      }

      #footer-push {
        height: 4rem;
      }

      footer {
        height: 4rem;
      }

      .agent-item {
        cursor: pointer;
      }

      .agent-item.selected {
        background-color: #d3e1ff;
      }

      .agent-item:hover {
        background-color: #e9f0ff;
      }
    </style>
  </head>
  <body class="bg-blue-50 h-full">
    {% include 'header.html' %}
    <main class="flex-grow">
      <div class="container mx-auto px-4 py-8 mt-12">
        <div class="mx-auto bg-white rounded-lg overflow-hidden md:max-w-lg">
          <div class="flex flex-col md:flex-row">
            <div class="w-full p-4 md:p-5">
              <div class="text-center mb-4">
                <h1 class="font-bold text-xl md:text-2xl">
                  Create New Timeframe
                </h1>
                <h3 class="text-lg md:text-xl">1-3 minutes per synth.</h3>
                <h4 class="text-md md:text-lg">
                  15 credits per synth adapted.
                </h4>
                <br />
                <div class="text-gray-400 text-sm">
                  Important: don't refresh the page.
                </div>
              </div>
              <form
                action="{{ url_for('auth_blueprint.create_agent_copy') }}"
                method="post"
              >
                <div class="mb-4">
                  <label for="name" class="block text-lg md:text-xl font-bold"
                    >Name this Window:</label
                  >
                  <input
                    type="text"
                    id="name"
                    name="name"
                    class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm md:text-sm"
                  />
                </div>
                <div class="mb-4">
                  <label
                    for="instruction1"
                    class="block text-sm font-bold text-gray-700"
                    >Describe the timepoint, including year:</label
                  >
                  <textarea
                    id="instruction1"
                    name="instruction1"
                    rows="4"
                    class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm md:text-sm"
                    required
                  ></textarea>
                </div>
                <div class="mb-4">
                  <label
                    for="instruction2"
                    class="block text-sm font-bold text-gray-700"
                    >Describe the setting, including place:</label
                  >
                  <textarea
                    id="instruction2"
                    name="instruction2"
                    rows="4"
                    class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm md:text-sm"
                  ></textarea>
                </div>
                <div class="mb-4">
                  <label
                    for="instruction3"
                    class="block text-sm font-bold text-gray-700"
                    >Describe the 'plot' and other context:</label
                  >
                  <textarea
                    id="instruction3"
                    name="instruction3"
                    rows="4"
                    class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm md:text-sm"
                  ></textarea>
                </div>
                <div class="mb-8">
                  <h2 class="text-lg md:text-xl font-bold mb-2">
                    {% if not agent_copies %}Base Agents{% else %}{% include
                    'add_base_agents.html' %}{{ agent_copies[0].name }}{% endif %}
                    Select Synths:
                  </h2>
                  <div id="agent-list">
                    <div class="mb-4 flex justify-between">
                      <button
                        type="button"
                        id="select-all"
                        class="px-4 py-2 text-sm md:px-6 md:py-3 bg-gray-400 text-white rounded-lg hover:bg-green-600"
                      >
                        Select All
                      </button>
                      <button
                        type="button"
                        id="clear-all"
                        class="px-2 py-1 text-sm md:px-2 md:py-1 bg-gray-200 text-white rounded-lg hover:bg-red-600"
                      >
                        Clear All
                      </button>
                    </div>
                    {% if agents %} {% for agent in agents %}
                    <div class="agent-item flex items-center mb-2 bg-white shadow-md rounded-lg px-8 pt-6 pb-8" data-agent-id="{{ agent.id }}">
                    <input type="checkbox" id="agent-{{ agent.id }}" name="selected_agents" value="{{ agent.id }}" class="hidden">
                    <img src="{{ agent.photo_path }}" alt="Agent Profile" class="float-right w-12 h-12 md:w-28 md:h-28 rounded-full -ml-2 mr-4">
                      <label
                        for="agent-{{ agent.id }}"
                        class="text-gray-700 text-sm md:text-md"
                      >
                        <div class="text-lg md:text-xl font-bold mb-2">
                          {{ agent.id }}
                        </div>
                        <div class="mb-2">{{ agent.jobtitle }}</div>
                        <div class="mb-2">{{ agent.summary }}</div>
                      </label>
                    </div>
                    {% endfor %} {% else %}
                    <p>No agents available.</p>
                    {% endif %}
                  </div>
                </div>
                <button
                  type="submit"
                  class="px-4 py-2 md:px-6 md:py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 w-full text-sm md:text-md"
                >
                  Render Window of Time
                </button>
                <div class="text-center">
                  <img
                    id="loading"
                    src="{{ url_for('static', filename='loading.gif') }}"
                    style="display: none; margin-top: 10px; max-width: 60px"
                    alt="Loading"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>
    <div id="footer-push"></div>
    {% include 'footer.html' %}

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const loading = document.getElementById("loading");

        form.addEventListener("submit", function (e) {
          const filenameInput = document.getElementById("filename");
          filenameInput.value = filenameInput.value.replace(/\s+/g, "_");

          loading.style.display = "block";
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const loading = document.getElementById("loading");
        const agentItems = document.querySelectorAll(".agent-item");
        const selectAllButton = document.getElementById("select-all");
        const clearAllButton = document.getElementById("clear-all");
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');

        // Form submit event
        form.addEventListener("submit", function (e) {
          // Code for handling the submit event
        });

        // Individual agent item click event
        agentItems.forEach((item) => {
          item.addEventListener("click", function (e) {
            // Prevent form from submitting if the form is clicked
            e.preventDefault();

            // Check the clicked element is not the checkbox itself
            if (e.target !== this.querySelector('input[type="checkbox"]')) {
              const checkbox = this.querySelector('input[type="checkbox"]');
              checkbox.checked = !checkbox.checked;
              this.classList.toggle("selected", checkbox.checked);
            }
          });
        });

        // Select All button click event
        selectAllButton.addEventListener("click", function (e) {
          e.preventDefault(); // Prevent default button click behavior
          checkboxes.forEach((checkbox) => {
            checkbox.checked = true;
            checkbox.closest(".agent-item").classList.add("selected");
          });
        });

        // Clear All button click event
        clearAllButton.addEventListener("click", function (e) {
          e.preventDefault(); // Prevent default button click behavior
          checkboxes.forEach((checkbox) => {
            checkbox.checked = false;
            checkbox.closest(".agent-item").classList.remove("selected");
          });
        });
      });
    </script>
  </body>
</html>
